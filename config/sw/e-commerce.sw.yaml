---
id: commerce
version: '1.0'
name: E commerce workflow
start: ProcessOrder
functions:
- name: orderNew
  type: custom
  operation: "rest:post:/"
- name: payment
  type: custom
  operation: "rest:post:/"
- name: inventoryReserve
  type: custom
  operation: "rest:post:/"
- name: orderUpdate
  type: custom
  operation: "rest:post:/"
- name: refund
  type: custom
  operation: "rest:post:/"
- name: inventoryRelease
  type: custom
  operation: "rest:post:/"
- name: success
  type: custom
  operation: "rest:post:/"
states:
- name: ProcessOrder
  type: operation
  actions:
  - functionRef:
      refName: orderNew
  compensatedBy: UpdateOrderStatus
  transition: ProcessPayment
- name: ProcessPayment
  type: operation
  actions:
  - functionRef:
      refName: payment
  compensatedBy: ProcessRefund
  transition: ReserveInventory
- name: ReserveInventory
  type: operation
  actions:
  - functionRef:
      refName: inventoryReserve
  compensatedBy: ReleaseInventory
  transition: Success
- name: Success
  type: operation
  actions:
  - functionRef:
      refName: success
  end: true
- name: ReleaseInventory
  type: operation
  usedForCompensation: true
  actions:
  - functionRef:
      refName: inventoryRelease
- name: ProcessRefund
  type: operation
  usedForCompensation: true
  actions:
  - functionRef:
      refName: refund
- name: UpdateOrderStatus
  type: operation
  usedForCompensation: true
  actions:
  - functionRef:
      refName: orderUpdate